# HUNONIC MARKETING TOOLS - IMPLEMENTATION GUIDE

> **H∆∞·ªõng d·∫´n tri·ªÉn khai chi ti·∫øt cho AI Code Generator**

---

## üìö DANH S√ÅCH FILES SPEC

### 1. Task Module Enhancement
- `SPEC_TASK_ENHANCEMENT.md` - Database schema, Templates, Recurring Tasks (Part 1)
- `SPEC_TASK_ENHANCEMENT_PART2.md` - Dependencies, Checklists, API endpoints, Migration scripts (Part 2)

### 2. CRM Module
- `SPEC_CRM_MODULE.md` - Database schema, Customer Management (Part 1)
- `SPEC_CRM_MODULE_PART2.md` - Interactions, Scenarios, Templates (Part 2)

---

## üöÄ TH·ª® T·ª∞ TRI·ªÇN KHAI ƒê·ªÄ XU·∫§T

### PHASE 1: TASK ENHANCEMENTS (Week 1-2)

#### Step 1.1: Database Migration
```bash
# ƒê·ªçc file v√† th·ª±c hi·ªán:
SPEC_TASK_ENHANCEMENT.md ‚Üí Section 1 (Database Schema)
SPEC_TASK_ENHANCEMENT_PART2.md ‚Üí Section 9 (Migration Scripts)

# T·∫°o files:
- migrations/010_task_enhancements.py
- migrations/011_seed_task_templates.py

# Ch·∫°y migrations:
python3 migrations/010_task_enhancements.py
python3 migrations/011_seed_task_templates.py
```

#### Step 1.2: Backend - Task Templates
```bash
# ƒê·ªçc v√† implement:
SPEC_TASK_ENHANCEMENT.md ‚Üí Section 2 (Task Templates Feature)

# T·∫°o file:
- backend/task_management/task_template_manager.py

# Test:
python3 backend/task_management/task_template_manager.py
```

#### Step 1.3: Backend - Recurring Tasks
```bash
# ƒê·ªçc v√† implement:
SPEC_TASK_ENHANCEMENT.md ‚Üí Section 3 (Recurring Tasks Feature)

# T·∫°o file:
- backend/task_management/recurring_task_manager.py

# Setup cron job:
0 * * * * cd /path/to/project && python3 backend/task_management/recurring_task_manager.py
```

#### Step 1.4: Backend - Task Dependencies
```bash
# ƒê·ªçc v√† implement:
SPEC_TASK_ENHANCEMENT_PART2.md ‚Üí Section 4 (Task Dependencies)

# T·∫°o file:
- backend/task_management/task_dependency_manager.py

# Modify existing:
- backend/task_management/simple_task_manager.py (th√™m dependency notification)
```

#### Step 1.5: Backend - Task Checklists
```bash
# ƒê·ªçc v√† implement:
SPEC_TASK_ENHANCEMENT_PART2.md ‚Üí Section 5 (Task Checklists)

# T·∫°o file:
- backend/task_management/task_checklist_manager.py
```

#### Step 1.6: Frontend Routes & Templates
```bash
# ƒê·ªçc v√† implement:
SPEC_TASK_ENHANCEMENT_PART2.md ‚Üí Section 7 (Frontend Implementation)

# Modify file:
- frontend/app.py (th√™m routes m·ªõi)

# T·∫°o templates:
- frontend/templates/tasks/task_templates.html
- frontend/templates/tasks/create_template.html
- frontend/templates/tasks/edit_template.html
- frontend/templates/tasks/create_from_template.html
- frontend/templates/tasks/recurring_tasks.html

# Modify templates:
- frontend/templates/tasks/task_detail.html (th√™m dependencies & checklists sections)
```

---

### PHASE 2: CRM MODULE (Week 3-5)

#### Step 2.1: Database Migration
```bash
# ƒê·ªçc file v√† th·ª±c hi·ªán:
SPEC_CRM_MODULE.md ‚Üí Section 1 (Database Schema)

# T·∫°o file:
- migrations/012_crm_module.py

# Ch·∫°y migration:
python3 migrations/012_crm_module.py
```

#### Step 2.2: Backend - Customer Management
```bash
# ƒê·ªçc v√† implement:
SPEC_CRM_MODULE.md ‚Üí Section 2 (Customer Management)

# T·∫°o file:
- backend/crm/customer_manager.py

# Test:
python3 backend/crm/customer_manager.py
```

#### Step 2.3: Backend - Interactions
```bash
# ƒê·ªçc v√† implement:
SPEC_CRM_MODULE_PART2.md ‚Üí Section 3 (Customer Interactions)

# T·∫°o file:
- backend/crm/interaction_manager.py
```

#### Step 2.4: Backend - Scenarios
```bash
# ƒê·ªçc v√† implement:
SPEC_CRM_MODULE_PART2.md ‚Üí Section 4 (Care Scenarios & Automation)

# T·∫°o file:
- backend/crm/scenario_manager.py

# Setup cron job:
0 * * * * cd /path/to/project && python3 backend/crm/scenario_manager.py
```

#### Step 2.5: Backend - Message Templates
```bash
# ƒê·ªçc v√† implement:
SPEC_CRM_MODULE_PART2.md ‚Üí Section 5 (Message Templates)

# T·∫°o file:
- backend/crm/template_manager.py
```

#### Step 2.6: Backend - Quotations
```bash
# ƒê·ªçc file CRM_MODULE_PART2 (n·∫øu c√≥ ph·∫ßn Quotations)

# T·∫°o file:
- backend/crm/quotation_manager.py
```

#### Step 2.7: Frontend CRM
```bash
# T·∫°o routes trong:
- frontend/app.py

# T·∫°o templates:
- frontend/templates/crm/customers_dashboard.html
- frontend/templates/crm/customer_detail.html
- frontend/templates/crm/create_customer.html
- frontend/templates/crm/scenarios.html
- frontend/templates/crm/templates.html
- frontend/templates/crm/quotations.html
- frontend/templates/crm/create_quotation.html
```

---

### PHASE 3: INTEGRATION (Week 6)

#### Step 3.1: Tasks ‚Üî CRM Integration
```bash
# Modifications c·∫ßn thi·∫øt:
1. Khi t·∫°o customer ‚Üí Auto t·∫°o task follow-up
2. Khi t·∫°o interaction ‚Üí Option t·∫°o related task
3. Task detail ‚Üí Show customer info n·∫øu linked
4. Customer detail ‚Üí Show related tasks

# Files c·∫ßn modify:
- backend/crm/customer_manager.py
- backend/crm/interaction_manager.py
- frontend/templates/tasks/task_detail.html
- frontend/templates/crm/customer_detail.html
```

---

## üìã CHECKLIST TRI·ªÇN KHAI

### Pre-deployment
```
‚ñ° Backup database hi·ªán t·∫°i
‚ñ° Test migrations tr√™n database copy
‚ñ° Review t·∫•t c·∫£ backend code
‚ñ° Test t·∫•t c·∫£ manager classes
‚ñ° Setup cron jobs (recurring_task_manager, scenario_manager)
```

### Backend
```
‚ñ° task_template_manager.py
‚ñ° recurring_task_manager.py
‚ñ° task_dependency_manager.py
‚ñ° task_checklist_manager.py
‚ñ° customer_manager.py
‚ñ° interaction_manager.py
‚ñ° scenario_manager.py
‚ñ° template_manager.py
‚ñ° quotation_manager.py
```

### Frontend Routes
```
‚ñ° Task Templates routes
‚ñ° Recurring Tasks routes
‚ñ° Task Dependencies API endpoints
‚ñ° Task Checklists API endpoints
‚ñ° Customer CRUD routes
‚ñ° Customer search/filter routes
‚ñ° Interaction routes
‚ñ° Scenario routes
‚ñ° Message Template routes
‚ñ° Quotation routes
```

### Frontend Templates
```
‚ñ° tasks/task_templates.html
‚ñ° tasks/create_template.html
‚ñ° tasks/recurring_tasks.html
‚ñ° tasks/task_detail.html (updated)
‚ñ° crm/customers_dashboard.html
‚ñ° crm/customer_detail.html
‚ñ° crm/create_customer.html
‚ñ° crm/scenarios.html
‚ñ° crm/templates.html
‚ñ° crm/quotations.html
```

### Migrations
```
‚ñ° 010_task_enhancements.py
‚ñ° 011_seed_task_templates.py
‚ñ° 012_crm_module.py
‚ñ° 013_seed_crm_data.py (optional)
```

### Cron Jobs
```
‚ñ° Recurring Task Processor (m·ªói gi·ªù)
‚ñ° Scenario Processor (m·ªói gi·ªù)
```

### Testing
```
‚ñ° Test Task Templates: Create, Use, Update, Delete
‚ñ° Test Recurring Tasks: Daily, Weekly, Monthly patterns
‚ñ° Test Dependencies: Add, Circular detection, Notifications
‚ñ° Test Checklists: CRUD, Toggle, Progress
‚ñ° Test Customer CRUD
‚ñ° Test Customer Search/Filter
‚ñ° Test Interactions
‚ñ° Test Scenarios: Auto-trigger, Steps execution
‚ñ° Test Message Templates
‚ñ° Test Quotations
‚ñ° Test Integration: Customer ‚Üí Task linkage
```

---

## üîß TROUBLESHOOTING

### L·ªói th∆∞·ªùng g·∫∑p

#### 1. Migration l·ªói "table already exists"
```python
# Solution: Th√™m IF NOT EXISTS
CREATE TABLE IF NOT EXISTS task_templates (...)
```

#### 2. Circular import trong managers
```python
# Solution: Import trong function thay v√¨ top-level
def some_function():
    from other_module import OtherManager
    manager = OtherManager(self.db)
```

#### 3. JSON serialization l·ªói
```python
# Solution: Ki·ªÉm tra tr∆∞·ªõc khi json.loads()
if field_value:
    data = json.loads(field_value)
else:
    data = []
```

#### 4. Datetime format kh√¥ng kh·ªõp
```python
# Solution: Consistent format
datetime.now().isoformat()  # "2025-11-01T14:30:00.123456"
datetime.strptime(date_str, '%Y-%m-%dT%H:%M')
```

---

## üìä TESTING PLAN

### Unit Tests

#### Task Module
```python
# test_task_template_manager.py
def test_create_template():
    # Test t·∫°o template v·ªõi ƒë·∫ßy ƒë·ªß fields
    pass

def test_use_template_with_variables():
    # Test variable replacement
    pass

def test_notification_offset_calculation():
    # Test t√≠nh notification times t·ª´ offsets
    pass

# test_recurring_task_manager.py
def test_weekly_recurrence():
    # Test weekly pattern v·ªõi multiple weekdays
    pass

def test_monthly_recurrence():
    # Test monthly pattern
    pass

def test_next_occurrence_calculation():
    # Test thu·∫≠t to√°n t√≠nh next occurrence
    pass

# test_task_dependency_manager.py
def test_circular_dependency_detection():
    # Test ph√°t hi·ªán circular dependency
    pass

def test_dependency_chain():
    # Test l·∫•y full dependency chain
    pass

# test_task_checklist_manager.py
def test_checklist_progress():
    # Test t√≠nh progress percentage
    pass
```

#### CRM Module
```python
# test_customer_manager.py
def test_create_customer():
    pass

def test_search_customers():
    # Test search + filters
    pass

def test_tags_management():
    # Test add/remove tags
    pass

# test_interaction_manager.py
def test_create_interaction_updates_customer():
    # Test side effects
    pass

# test_scenario_manager.py
def test_scenario_execution():
    # Test full scenario flow
    pass

def test_step_delay_calculation():
    pass

# test_template_manager.py
def test_template_variable_replacement():
    pass
```

### Integration Tests
```python
def test_customer_to_task_flow():
    # T·∫°o customer ‚Üí Trigger scenario ‚Üí T·∫°o task
    pass

def test_interaction_with_task():
    # T·∫°o interaction + task c√πng l√∫c
    pass

def test_quotation_with_customer():
    # T·∫°o quotation ‚Üí Link to customer
    pass
```

---

## üìù DOCUMENTATION NOTES

### Code Comments
- T·∫•t c·∫£ functions ph·∫£i c√≥ docstring r√µ r√†ng
- Algorithm ph·ª©c t·∫°p ph·∫£i c√≥ comment gi·∫£i th√≠ch
- Edge cases ph·∫£i ƒë∆∞·ª£c document

### API Documentation
- M·ªói endpoint ph·∫£i c√≥ description
- Request/Response format examples
- Error codes & messages

### User Guide
- Screenshots cho m·ªói feature m·ªõi
- Step-by-step tutorials
- FAQs

---

## üéØ SUCCESS CRITERIA

### Functional Requirements
‚úÖ User c√≥ th·ªÉ t·∫°o v√† s·ª≠ d·ª•ng task templates
‚úÖ Recurring tasks t·ª± ƒë·ªông generate ƒë√∫ng l·ªãch
‚úÖ Task dependencies ƒë∆∞·ª£c enforce (kh√¥ng circular)
‚úÖ Checklists hi·ªÉn th·ªã progress ch√≠nh x√°c
‚úÖ Customer CRUD ho·∫°t ƒë·ªông ƒë·∫ßy ƒë·ªß
‚úÖ Interactions ƒë∆∞·ª£c log ƒë·∫ßy ƒë·ªß
‚úÖ Scenarios t·ª± ƒë·ªông execute theo ƒë√∫ng timeline
‚úÖ Message templates render ƒë√∫ng variables
‚úÖ Quotations t√≠nh to√°n ch√≠nh x√°c

### Performance Requirements
‚úÖ Search customers < 500ms v·ªõi 10k records
‚úÖ Load customer detail < 200ms
‚úÖ Create task from template < 1s
‚úÖ Scenario processor ho√†n th√†nh trong 5 minutes (1000 customers)

### Security Requirements
‚úÖ Permissions ƒë∆∞·ª£c check ƒë√∫ng
‚úÖ User ch·ªâ th·∫•y customers ƒë∆∞·ª£c assign
‚úÖ Templates private kh√¥ng leak ra ngo√†i

---

## üöÄ DEPLOYMENT STEPS

### 1. Staging Environment
```bash
# Backup
pg_dump calendar_tools > backup_$(date +%Y%m%d).sql

# Deploy code
git pull origin develop
pip install -r requirements.txt

# Run migrations
python3 migrations/run_all_migrations.py

# Test
python3 -m pytest tests/

# Setup cron jobs
crontab -e
# Add:
# 0 * * * * cd /path && python3 backend/task_management/recurring_task_manager.py
# 0 * * * * cd /path && python3 backend/crm/scenario_manager.py
```

### 2. Production Deployment
```bash
# Same steps as staging
# + Monitor logs for first 24h
# + Be ready to rollback if issues
```

---

## üìû SUPPORT

N·∫øu g·∫∑p v·∫•n ƒë·ªÅ trong qu√° tr√¨nh implement, check l·∫°i:
1. Database schema c√≥ ƒë√∫ng kh√¥ng (PRAGMA table_info)
2. Foreign keys c√≥ ƒë∆∞·ª£c t·∫°o kh√¥ng
3. Indexes c√≥ ƒë∆∞·ª£c t·∫°o kh√¥ng
4. Cron jobs c√≥ ƒëang ch·∫°y kh√¥ng (check logs)
5. Permissions c√≥ ƒë·ªß kh√¥ng

---

**END OF IMPLEMENTATION GUIDE**

**T·∫°o b·ªüi:** Claude Code Agent
**Ng√†y:** 01/11/2025
**Version:** 1.0
