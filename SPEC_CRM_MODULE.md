# SPEC: CRM MODULE - QU·∫¢N L√ù KH√ÅCH H√ÄNG

> **M·ª•c ƒë√≠ch:** X√¢y d·ª±ng module CRM ho√†n ch·ªânh ƒë·ªÉ qu·∫£n l√Ω kh√°ch h√†ng, t∆∞∆°ng t√°c, k·ªãch b·∫£n chƒÉm s√≥c, b√°o gi√°
>
> **Codebase hi·ªán t·∫°i:** Python/Flask + SQLite
>
> **Integration:** Li√™n k·∫øt ch·∫∑t ch·∫Ω v·ªõi Tasks Module

---

## üìã M·ª§C L·ª§C

1. [Database Schema](#1-database-schema)
2. [Customer Management](#2-customer-management)
3. [Customer Interactions](#3-customer-interactions)
4. [Care Scenarios & Automation](#4-care-scenarios--automation)
5. [Message Templates](#5-message-templates)
6. [Quotations](#6-quotations)
7. [Backend Implementation](#7-backend-implementation)
8. [Frontend Implementation](#8-frontend-implementation)
9. [API Endpoints](#9-api-endpoints)
10. [CRM ‚Üî Tasks Integration](#10-crm--tasks-integration)
11. [Migration Scripts](#11-migration-scripts)

---

## 1. DATABASE SCHEMA

### 1.1. Core Tables

#### A. `customers` - Kh√°ch h√†ng

```sql
CREATE TABLE customers (
    customer_id TEXT PRIMARY KEY,               -- "cust_abc123"
    user_id TEXT,                               -- Sales ph·ª• tr√°ch

    -- Th√¥ng tin c∆° b·∫£n
    full_name TEXT NOT NULL,
    phone_number TEXT,
    email TEXT,
    company_name TEXT,
    tax_code TEXT,                              -- M√£ s·ªë thu·∫ø

    -- ƒê·ªãa ch·ªâ & v·ªã tr√≠
    address TEXT,
    city TEXT,
    district TEXT,
    ward TEXT,
    google_maps_url TEXT,
    latitude REAL,
    longitude REAL,

    -- Ph√¢n lo·∫°i
    customer_type TEXT DEFAULT 'individual',    -- individual/business/dealer/distributor
    lead_source TEXT,                           -- facebook/zalo/website/referral/exhibition/other
    lead_status TEXT DEFAULT 'new',             -- new/contacted/qualified/proposal/negotiation/won/lost/archived
    priority_level TEXT DEFAULT 'cold',         -- hot/warm/cold

    -- Th√¥ng tin kinh doanh
    industry TEXT,                              -- Lƒ©nh v·ª±c: hotel/villa/apartment/office/retail
    project_scale TEXT,                         -- small/medium/large
    estimated_budget REAL,
    expected_close_date TEXT,

    -- Tracking
    assigned_to TEXT,                           -- User ph·ª• tr√°ch
    last_contact_date TEXT,
    next_follow_up_date TEXT,
    total_interactions INTEGER DEFAULT 0,
    total_revenue REAL DEFAULT 0,
    total_orders INTEGER DEFAULT 0,

    -- Social & Contact
    facebook_url TEXT,
    zalo_id TEXT,
    telegram_id TEXT,
    website TEXT,

    -- Tags & notes
    tags TEXT,                                  -- JSON array: ["vip", "fast_decision", "price_sensitive"]
    notes TEXT,                                 -- Ghi ch√∫ chung

    -- Metadata
    created_at TEXT,
    updated_at TEXT,
    created_by TEXT,

    FOREIGN KEY (user_id) REFERENCES users(user_id),
    FOREIGN KEY (assigned_to) REFERENCES users(user_id),
    FOREIGN KEY (created_by) REFERENCES users(user_id)
);

-- Indexes
CREATE INDEX idx_customers_user ON customers(user_id);
CREATE INDEX idx_customers_assigned ON customers(assigned_to);
CREATE INDEX idx_customers_lead_status ON customers(lead_status);
CREATE INDEX idx_customers_priority ON customers(priority_level);
CREATE INDEX idx_customers_phone ON customers(phone_number);
CREATE INDEX idx_customers_email ON customers(email);
CREATE INDEX idx_customers_next_follow_up ON customers(next_follow_up_date);

-- Full-text search (n·∫øu SQLite h·ªó tr·ª£ FTS)
-- CREATE VIRTUAL TABLE customers_fts USING fts5(customer_id, full_name, phone_number, email, company_name);
```

**Sample Data:**
```sql
INSERT INTO customers VALUES (
    'cust_001',
    'user_123',
    'Nguy·ªÖn VƒÉn A',
    '0909123456',
    'nguyenvana@email.com',
    'C√¥ng ty ABC',
    '0123456789',
    '123 ƒê∆∞·ªùng XYZ, Ph∆∞·ªùng 1',
    'TP. H·ªì Ch√≠ Minh',
    'Qu·∫≠n 2',
    'Ph∆∞·ªùng Th·∫£o ƒêi·ªÅn',
    'https://maps.google.com/?q=10.123,106.456',
    10.123,
    106.456,
    'business',
    'website',
    'qualified',
    'hot',
    'villa',
    'large',
    2500000000,  -- 2.5 t·ª∑
    '2025-12-31',
    'user_123',
    '2025-11-01 14:30:00',
    '2025-11-05 14:00:00',
    5,  -- 5 interactions
    0,  -- ch∆∞a c√≥ doanh thu
    0,  -- ch∆∞a c√≥ orders
    'https://facebook.com/nguyenvana',
    '0909123456',
    NULL,
    'https://company-abc.com',
    '["vip", "fast_decision"]',
    'Kh√°ch h√†ng ti·ªÅm nƒÉng cao, ƒë√£ l√†m vi·ªác v·ªõi nhi·ªÅu nh√† th·∫ßu, quy·∫øt ƒë·ªãnh nhanh',
    '2025-10-15 10:00:00',
    '2025-11-01 14:30:00',
    'user_admin'
);
```

---

#### B. `customer_interactions` - L·ªãch s·ª≠ t∆∞∆°ng t√°c

```sql
CREATE TABLE customer_interactions (
    interaction_id TEXT PRIMARY KEY,            -- "int_abc123"
    customer_id TEXT NOT NULL,
    user_id TEXT NOT NULL,                      -- Ng∆∞·ªùi t∆∞∆°ng t√°c

    interaction_type TEXT NOT NULL,             -- call/email/meeting/zalo/telegram/visit/other
    direction TEXT DEFAULT 'outbound',          -- inbound/outbound

    subject TEXT,
    content TEXT,                               -- N·ªôi dung t∆∞∆°ng t√°c
    outcome TEXT,                               -- interested/not_interested/callback/need_more_info/closed/no_answer

    next_action TEXT,                           -- H√†nh ƒë·ªông ti·∫øp theo c·∫ßn l√†m
    next_action_date TEXT,

    -- Link to other entities
    related_task_id TEXT,                       -- Task ƒë∆∞·ª£c t·∫°o t·ª´ interaction n√†y
    related_quotation_id TEXT,                  -- B√°o gi√° li√™n quan

    -- Attachments
    attachments TEXT,                           -- JSON array of file paths

    -- Duration (for calls/meetings)
    duration_minutes INTEGER,

    interaction_date TEXT NOT NULL,
    created_at TEXT,

    FOREIGN KEY (customer_id) REFERENCES customers(customer_id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(user_id),
    FOREIGN KEY (related_task_id) REFERENCES tasks(task_id),
    FOREIGN KEY (related_quotation_id) REFERENCES quotations(quotation_id)
);

-- Indexes
CREATE INDEX idx_interactions_customer ON customer_interactions(customer_id);
CREATE INDEX idx_interactions_user ON customer_interactions(user_id);
CREATE INDEX idx_interactions_date ON customer_interactions(interaction_date);
CREATE INDEX idx_interactions_type ON customer_interactions(interaction_type);
```

**Sample Data:**
```sql
INSERT INTO customer_interactions VALUES (
    'int_001',
    'cust_001',
    'user_123',
    'call',
    'outbound',
    'G·ªçi ƒëi·ªán t∆∞ v·∫•n g√≥i Smart Lighting',
    'ƒê√£ gi·ªõi thi·ªáu s·∫£n ph·∫©m, kh√°ch h√†ng quan t√¢m ƒë·∫øn t√≠nh nƒÉng ƒëi·ªÅu khi·ªÉn t·ª´ xa v√† t√≠ch h·ª£p AI. Y√™u c·∫ßu xem demo.',
    'interested',
    'H·∫πn l·ªãch demo t·∫°i vƒÉn ph√≤ng kh√°ch h√†ng',
    '2025-11-05 14:00:00',
    NULL,  -- ch∆∞a t·∫°o task
    NULL,  -- ch∆∞a c√≥ quotation
    NULL,  -- no attachments
    30,  -- 30 minutes
    '2025-11-01 14:30:00',
    '2025-11-01 15:00:00'
);
```

---

#### C. `customer_care_scenarios` - K·ªãch b·∫£n chƒÉm s√≥c

```sql
CREATE TABLE customer_care_scenarios (
    scenario_id TEXT PRIMARY KEY,               -- "scenario_abc123"
    scenario_name TEXT NOT NULL,
    scenario_description TEXT,

    customer_segment TEXT,                      -- new_lead/warm_lead/hot_lead/existing_customer/lost_customer
    trigger_event TEXT,                         -- customer_created/first_contact/no_response_3days/won_deal

    is_active BOOLEAN DEFAULT 1,
    created_by TEXT,
    created_at TEXT,
    updated_at TEXT,

    FOREIGN KEY (created_by) REFERENCES users(user_id)
);

CREATE INDEX idx_scenarios_segment ON customer_care_scenarios(customer_segment);
CREATE INDEX idx_scenarios_active ON customer_care_scenarios(is_active);
```

**Sample Data:**
```sql
INSERT INTO customer_care_scenarios VALUES (
    'scenario_001',
    'Lead m·ªõi t·ª´ Facebook',
    'K·ªãch b·∫£n t·ª± ƒë·ªông chƒÉm s√≥c lead m·ªõi t·ª´ Facebook: G·ª≠i Zalo ch√†o m·ª´ng, g·ªçi ƒëi·ªán trong 2h, follow up sau 3 ng√†y',
    'new_lead',
    'customer_created',
    1,
    'admin',
    '2025-11-01 10:00:00',
    '2025-11-01 10:00:00'
);
```

---

#### D. `scenario_steps` - C√°c b∆∞·ªõc trong k·ªãch b·∫£n

```sql
CREATE TABLE scenario_steps (
    step_id TEXT PRIMARY KEY,
    scenario_id TEXT NOT NULL,
    step_order INTEGER NOT NULL,

    step_name TEXT NOT NULL,
    step_description TEXT,

    step_type TEXT NOT NULL,                    -- auto_task/auto_notification/auto_message/manual_action

    -- Timing
    delay_days INTEGER DEFAULT 0,
    delay_hours INTEGER DEFAULT 0,
    delay_from TEXT DEFAULT 'previous_step',    -- scenario_start/previous_step/customer_created

    -- Action details
    action_type TEXT,                           -- call/email/zalo/telegram/sms/visit
    template_id TEXT,                           -- Link to message template (n·∫øu auto_message)
    task_template_id TEXT,                      -- Link to task template (n·∫øu auto_task)

    is_required BOOLEAN DEFAULT 1,
    created_at TEXT,

    FOREIGN KEY (scenario_id) REFERENCES customer_care_scenarios(scenario_id) ON DELETE CASCADE,
    FOREIGN KEY (template_id) REFERENCES message_templates(template_id),
    FOREIGN KEY (task_template_id) REFERENCES task_templates(template_id)
);

CREATE INDEX idx_scenario_steps_scenario ON scenario_steps(scenario_id);
CREATE INDEX idx_scenario_steps_order ON scenario_steps(scenario_id, step_order);
```

**Sample Data:**
```sql
-- Step 1: Auto g·ª≠i Zalo ch√†o m·ª´ng ngay
INSERT INTO scenario_steps VALUES (
    'step_001',
    'scenario_001',
    1,
    'G·ª≠i Zalo ch√†o m·ª´ng',
    'T·ª± ƒë·ªông g·ª≠i tin nh·∫Øn Zalo ch√†o m·ª´ng kh√°ch h√†ng m·ªõi',
    'auto_message',
    0, 0,  -- Ngay l·∫≠p t·ª©c
    'scenario_start',
    'zalo',
    'tmsg_welcome_001',  -- Template message
    NULL,  -- Kh√¥ng c√≥ task template
    1,
    '2025-11-01 10:00:00'
);

-- Step 2: T·∫°o task g·ªçi ƒëi·ªán sau 2h
INSERT INTO scenario_steps VALUES (
    'step_002',
    'scenario_001',
    2,
    'G·ªçi ƒëi·ªán t∆∞ v·∫•n',
    'T·∫°o task nh·∫Øc sales g·ªçi ƒëi·ªán trong v√≤ng 2 gi·ªù',
    'auto_task',
    0, 2,  -- Sau 2 gi·ªù
    'scenario_start',
    'call',
    NULL,  -- Kh√¥ng c√≥ message template
    'tmpl_default_001',  -- Task template "G·ªçi ƒëi·ªán ch√†o kh√°ch h√†ng m·ªõi"
    1,
    '2025-11-01 10:00:00'
);

-- Step 3: Follow up sau 3 ng√†y
INSERT INTO scenario_steps VALUES (
    'step_003',
    'scenario_001',
    3,
    'Follow up sau 3 ng√†y',
    'N·∫øu ch∆∞a c√≥ ph·∫£n h·ªìi, t·ª± ƒë·ªông t·∫°o task follow up',
    'auto_task',
    3, 0,  -- Sau 3 ng√†y
    'scenario_start',
    'call',
    NULL,
    'tmpl_default_002',  -- Task template "Follow up"
    0,  -- Optional
    '2025-11-01 10:00:00'
);
```

---

#### E. `customer_scenario_tracking` - Tracking k·ªãch b·∫£n ƒëang ch·∫°y

```sql
CREATE TABLE customer_scenario_tracking (
    tracking_id TEXT PRIMARY KEY,
    customer_id TEXT NOT NULL,
    scenario_id TEXT NOT NULL,

    current_step_order INTEGER DEFAULT 0,
    scenario_status TEXT DEFAULT 'active',      -- active/paused/completed/cancelled

    started_at TEXT,
    completed_at TEXT,
    last_action_at TEXT,

    created_by TEXT,

    FOREIGN KEY (customer_id) REFERENCES customers(customer_id) ON DELETE CASCADE,
    FOREIGN KEY (scenario_id) REFERENCES customer_care_scenarios(scenario_id),
    FOREIGN KEY (created_by) REFERENCES users(user_id)
);

CREATE INDEX idx_tracking_customer ON customer_scenario_tracking(customer_id);
CREATE INDEX idx_tracking_scenario ON customer_scenario_tracking(scenario_id);
CREATE INDEX idx_tracking_status ON customer_scenario_tracking(scenario_status);
```

---

#### F. `message_templates` - Template tin nh·∫Øn

```sql
CREATE TABLE message_templates (
    template_id TEXT PRIMARY KEY,               -- "tmsg_abc123"
    user_id TEXT,                               -- NULL = shared template

    template_name TEXT NOT NULL,
    template_description TEXT,

    channel TEXT NOT NULL,                      -- email/zalo/telegram/sms
    category TEXT,                              -- greeting/follow_up/quotation/thank_you/promotion/other

    -- Content
    subject TEXT,                               -- Cho email
    content TEXT NOT NULL,                      -- N·ªôi dung (h·ªó tr·ª£ variables)

    -- Variables support
    variables_help TEXT,                        -- Help text cho variables: {customer_name}, {product_name}...

    is_shared BOOLEAN DEFAULT 0,
    created_by TEXT,
    usage_count INTEGER DEFAULT 0,

    created_at TEXT,
    updated_at TEXT,

    FOREIGN KEY (user_id) REFERENCES users(user_id),
    FOREIGN KEY (created_by) REFERENCES users(user_id)
);

CREATE INDEX idx_message_templates_user ON message_templates(user_id);
CREATE INDEX idx_message_templates_channel ON message_templates(channel);
CREATE INDEX idx_message_templates_category ON message_templates(category);
CREATE INDEX idx_message_templates_shared ON message_templates(is_shared);
```

**Sample Data:**
```sql
INSERT INTO message_templates VALUES (
    'tmsg_welcome_001',
    NULL,  -- Shared
    'Ch√†o m·ª´ng kh√°ch h√†ng m·ªõi - Zalo',
    'Template ch√†o m·ª´ng kh√°ch h√†ng m·ªõi qua Zalo',
    'zalo',
    'greeting',
    NULL,  -- Zalo kh√¥ng c√≥ subject
    'Xin ch√†o {customer_name},

C·∫£m ∆°n b·∫°n ƒë√£ quan t√¢m ƒë·∫øn s·∫£n ph·∫©m nh√† th√¥ng minh Hunonic!

Ch√∫ng t√¥i chuy√™n cung c·∫•p gi·∫£i ph√°p Smart Home to√†n di·ªán cho:
‚Ä¢ Bi·ªát th·ª± & CƒÉn h·ªô cao c·∫•p
‚Ä¢ Kh√°ch s·∫°n & Resort
‚Ä¢ VƒÉn ph√≤ng th√¥ng minh

Hunonic r·∫•t mong ƒë∆∞·ª£c t∆∞ v·∫•n mi·ªÖn ph√≠ cho d·ª± √°n c·ªßa b·∫°n.

Xin vui l√≤ng cho bi·∫øt th·ªùi gian thu·∫≠n ti·ªán ƒë·ªÉ ch√∫ng t√¥i li√™n h·ªá.

Tr√¢n tr·ªçng,
Hunonic Smart Home
Hotline: 1900-xxxx',
    'Variables: {customer_name}, {sales_name}, {sales_phone}',
    1,  -- shared
    'admin',
    0,
    '2025-11-01 10:00:00',
    '2025-11-01 10:00:00'
);
```

---

#### G. `quotations` - B√°o gi√°

```sql
CREATE TABLE quotations (
    quotation_id TEXT PRIMARY KEY,              -- "quot_abc123"
    customer_id TEXT NOT NULL,
    user_id TEXT NOT NULL,                      -- Ng∆∞·ªùi t·∫°o b√°o gi√°

    quotation_number TEXT UNIQUE NOT NULL,      -- "QT-2025-001" (auto-increment)
    title TEXT NOT NULL,
    description TEXT,

    -- Financial
    subtotal REAL DEFAULT 0,
    discount_percent REAL DEFAULT 0,
    discount_amount REAL DEFAULT 0,
    tax_percent REAL DEFAULT 0,                 -- VAT 10%
    tax_amount REAL DEFAULT 0,
    total_amount REAL DEFAULT 0,

    -- Status
    status TEXT DEFAULT 'draft',                -- draft/sent/viewed/accepted/rejected/expired
    valid_until TEXT,

    -- Tracking
    sent_at TEXT,
    viewed_at TEXT,
    accepted_at TEXT,
    rejected_at TEXT,

    notes TEXT,
    terms_and_conditions TEXT,

    created_at TEXT,
    updated_at TEXT,

    FOREIGN KEY (customer_id) REFERENCES customers(customer_id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(user_id)
);

CREATE INDEX idx_quotations_customer ON quotations(customer_id);
CREATE INDEX idx_quotations_user ON quotations(user_id);
CREATE INDEX idx_quotations_status ON quotations(status);
CREATE INDEX idx_quotations_number ON quotations(quotation_number);
```

**Sample Data:**
```sql
INSERT INTO quotations VALUES (
    'quot_001',
    'cust_001',
    'user_123',
    'QT-2025-001',
    'B√°o gi√° h·ªá th·ªëng Smart Home - Villa Th·∫£o ƒêi·ªÅn',
    'B√°o gi√° chi ti·∫øt cho h·ªá th·ªëng Smart Home t·∫°i Villa Th·∫£o ƒêi·ªÅn, bao g·ªìm chi·∫øu s√°ng th√¥ng minh, r√®m c·ª≠a t·ª± ƒë·ªông, ƒëi·ªÅu h√≤a AI',
    2000000000,  -- 2 t·ª∑ subtotal
    5,  -- 5% discount
    100000000,  -- 100tr discount
    10,  -- 10% VAT
    190000000,  -- 190tr VAT
    2090000000,  -- 2.09 t·ª∑ total
    'sent',
    '2025-12-31',
    '2025-11-02 10:00:00',
    '2025-11-02 14:30:00',  -- viewed
    NULL,  -- ch∆∞a accept
    NULL,  -- ch∆∞a reject
    'Gi√° ƒë√£ bao g·ªìm l·∫Øp ƒë·∫∑t v√† b·∫£o h√†nh 24 th√°ng',
    'ƒêi·ªÅu kho·∫£n & ƒëi·ªÅu ki·ªán:\n- B√°o gi√° c√≥ hi·ªáu l·ª±c 30 ng√†y\n- Thanh to√°n: 30% ƒë·∫∑t c·ªçc, 40% khi thi c√¥ng, 30% khi nghi·ªám thu\n- B·∫£o h√†nh 24 th√°ng',
    '2025-11-02 09:00:00',
    '2025-11-02 14:30:00'
);
```

---

#### H. `quotation_items` - Chi ti·∫øt b√°o gi√°

```sql
CREATE TABLE quotation_items (
    item_id TEXT PRIMARY KEY,
    quotation_id TEXT NOT NULL,

    item_type TEXT DEFAULT 'product',           -- product/service/installation/warranty
    product_name TEXT NOT NULL,
    description TEXT,
    unit TEXT DEFAULT 'c√°i',

    quantity INTEGER NOT NULL,
    unit_price REAL NOT NULL,
    subtotal REAL NOT NULL,

    sort_order INTEGER DEFAULT 0,

    FOREIGN KEY (quotation_id) REFERENCES quotations(quotation_id) ON DELETE CASCADE
);

CREATE INDEX idx_quotation_items_quotation ON quotation_items(quotation_id);
CREATE INDEX idx_quotation_items_order ON quotation_items(quotation_id, sort_order);
```

**Sample Data:**
```sql
INSERT INTO quotation_items VALUES
('item_001', 'quot_001', 'product', 'C√¥ng t·∫Øc th√¥ng minh WiFi', '3 gang, ƒëi·ªÅu khi·ªÉn t·ª´ xa', 'c√°i', 50, 500000, 25000000, 1),
('item_002', 'quot_001', 'product', 'Gateway Zigbee', 'Hub trung t√¢m ƒëi·ªÅu khi·ªÉn', 'c√°i', 5, 2000000, 10000000, 2),
('item_003', 'quot_001', 'product', 'Motor r√®m th√¥ng minh', 'ƒê·ªông c∆° r√®m t·ª± ƒë·ªông Somfy', 'b·ªô', 20, 3000000, 60000000, 3),
('item_004', 'quot_001', 'product', 'Sensor c·ª≠a', 'C·∫£m bi·∫øn m·ªü/ƒë√≥ng c·ª≠a', 'c√°i', 30, 200000, 6000000, 4),
('item_005', 'quot_001', 'service', 'L·∫Øp ƒë·∫∑t & L·∫≠p tr√¨nh', 'Thi c√¥ng, l·∫Øp ƒë·∫∑t, l·∫≠p tr√¨nh k·ªãch b·∫£n', 'g√≥i', 1, 500000000, 500000000, 5),
('item_006', 'quot_001', 'warranty', 'B·∫£o h√†nh m·ªü r·ªông', 'B·∫£o h√†nh 24 th√°ng + b·∫£o tr√¨ ƒë·ªãnh k·ª≥', 'nƒÉm', 2, 50000000, 100000000, 6);
```

---

### 1.2. Summary of Tables

```
CRM MODULE TABLES:
1. customers                    - Th√¥ng tin kh√°ch h√†ng
2. customer_interactions        - L·ªãch s·ª≠ t∆∞∆°ng t√°c
3. customer_care_scenarios      - K·ªãch b·∫£n chƒÉm s√≥c
4. scenario_steps               - C√°c b∆∞·ªõc trong k·ªãch b·∫£n
5. customer_scenario_tracking   - Tracking k·ªãch b·∫£n ƒëang ch·∫°y
6. message_templates            - Template tin nh·∫Øn
7. quotations                   - B√°o gi√°
8. quotation_items              - Chi ti·∫øt b√°o gi√°
```

---

## 2. CUSTOMER MANAGEMENT

### 2.1. UI Mockup - Customer Dashboard

```html
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üë• QU·∫¢N L√ù KH√ÅCH H√ÄNG                      [+ Th√™m KH m·ªõi]      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                   ‚îÇ
‚îÇ  üìä T·ªîNG QUAN                                                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ üî• HOT     ‚îÇ  ‚îÇ üü° WARM    ‚îÇ  ‚îÇ üîµ COLD    ‚îÇ  ‚îÇ ‚úÖ WON     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    24      ‚îÇ  ‚îÇ    67      ‚îÇ  ‚îÇ    143     ‚îÇ  ‚îÇ    89      ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  +3 tu·∫ßn   ‚îÇ  ‚îÇ  -5 tu·∫ßn   ‚îÇ  ‚îÇ  +12 tu·∫ßn  ‚îÇ  ‚îÇ  +8 th√°ng  ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  üîç [T√¨m ki·∫øm: t√™n, SƒêT, email...]    [üîΩ L·ªçc]  [üìä B√°o c√°o]     ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  ‚îå‚îÄ FILTERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ Status: [All ‚ñº]  Priority: [All ‚ñº]  Source: [All ‚ñº]     ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ Assigned: [Me ‚ñº]  Follow-up: [Today ‚ñº]                  ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  üìã C·∫¶N FOLLOW H√îM NAY (12)                                       ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ üî• Nguy·ªÖn VƒÉn A - Villa Th·∫£o ƒêi·ªÅn                           ‚îÇ‚îÇ
‚îÇ  ‚îÇ    üìû 0909123456 | ‚úâÔ∏è nguyenvana@email.com                  ‚îÇ‚îÇ
‚îÇ  ‚îÇ    üè¢ C√¥ng ty ABC | üìç Q2, TP.HCM                           ‚îÇ‚îÇ
‚îÇ  ‚îÇ    üí∞ Budget: 2.5 t·ª∑ | üìÖ Close: Q4/2025                    ‚îÇ‚îÇ
‚îÇ  ‚îÇ    ‚è∞ Follow l√∫c 14:00 - G·ªçi t∆∞ v·∫•n g√≥i Smart Lighting      ‚îÇ‚îÇ
‚îÇ  ‚îÇ    üìù Note: ƒê√£ g·ª≠i b√°o gi√° QT-2025-001                      ‚îÇ‚îÇ
‚îÇ  ‚îÇ    T∆∞∆°ng t√°c: 5 l·∫ßn | L·∫ßn cu·ªëi: 01/11 14:30                ‚îÇ‚îÇ
‚îÇ  ‚îÇ                                                              ‚îÇ‚îÇ
‚îÇ  ‚îÇ    [üëÅÔ∏è Xem] [üìû G·ªçi] [‚úâÔ∏è Email] [üí¨ Zalo] [üí∞ B√°o gi√°]      ‚îÇ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§‚îÇ
‚îÇ  ‚îÇ üü° Tr·∫ßn Th·ªã B - Chung c∆∞ Vinhomes                           ‚îÇ‚îÇ
‚îÇ  ‚îÇ    üìû 0901234567 | ‚úâÔ∏è tranthib@email.com                    ‚îÇ‚îÇ
‚îÇ  ‚îÇ    üìç Q9, TP.HCM                                            ‚îÇ‚îÇ
‚îÇ  ‚îÇ    üí∞ Budget: 800tr | üìÖ Close: Q1/2026                     ‚îÇ‚îÇ
‚îÇ  ‚îÇ    ‚è∞ Follow l√∫c 16:00 - G·ª≠i catalog s·∫£n ph·∫©m               ‚îÇ‚îÇ
‚îÇ  ‚îÇ    T∆∞∆°ng t√°c: 2 l·∫ßn | L·∫ßn cu·ªëi: 28/10 10:00                ‚îÇ‚îÇ
‚îÇ  ‚îÇ                                                              ‚îÇ‚îÇ
‚îÇ  ‚îÇ    [üëÅÔ∏è Xem] [üìû G·ªçi] [‚úâÔ∏è Email] [üí¨ Zalo] [üí∞ B√°o gi√°]      ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  üìã T·∫§T C·∫¢ KH√ÅCH H√ÄNG (323) - [Show: 25 ‚ñº] [Page 1/13]          ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  [Xu·∫•t Excel] [Import kh√°ch h√†ng] [G·ª≠i h√†ng lo·∫°t]               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 2.2. UI Mockup - Customer Detail

```html
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ‚Üê Quay l·∫°i              üë§ NGUY·ªÑN VƒÇN A         [‚úèÔ∏è S·ª≠a] [üóëÔ∏è]    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                   ‚îÇ
‚îÇ  ‚îå‚îÄ TH√îNG TIN C∆† B·∫¢N ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ TR·∫†NG TH√ÅI ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ üì± 0909123456                    ‚îÇ  ‚îÇ üî• HOT               ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚úâÔ∏è nguyenvana@email.com          ‚îÇ  ‚îÇ üíº Qualified         ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ üè¢ C√¥ng ty ABC (MST: 0123456789) ‚îÇ  ‚îÇ üìÅ Business          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ üìç 123 ƒê∆∞·ªùng XYZ, P.Th·∫£o ƒêi·ªÅn,   ‚îÇ  ‚îÇ üë§ Ph·ª• tr√°ch: H·∫£i    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    Q2, TP.HCM                    ‚îÇ  ‚îÇ üìÖ Follow: 05/11     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ üó∫Ô∏è [Xem Google Maps]             ‚îÇ  ‚îÇ üí∞ Budget: 2.5 t·ª∑    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                   ‚îÇ  ‚îÇ üéØ Source: Website   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ üîó Social:                        ‚îÇ  ‚îÇ üè∑Ô∏è Tags:             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    [Facebook] [Zalo] [Website]   ‚îÇ  ‚îÇ    [VIP]             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                   ‚îÇ  ‚îÇ    [Fast Decision]   ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ  ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  [üìã T·ªïng quan] [üí¨ T∆∞∆°ng t√°c] [üí∞ B√°o gi√°] [üèóÔ∏è D·ª± √°n] [üìù Ghi ch√∫]‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ  ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  üèóÔ∏è D·ª∞ √ÅN HI·ªÜN T·∫†I                                               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ üè† Villa Th·∫£o ƒêi·ªÅn - Smart Home Automation              ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ Quy m√¥: 500m¬≤, 3 t·∫ßng | Ng√¢n s√°ch: 2.5 t·ª∑              ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ ƒê√≥ng d·ª± ki·∫øn: Q1/2026                                   ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ Y√™u c·∫ßu:                                                ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ ƒêi·ªÅu khi·ªÉn chi·∫øu s√°ng th√¥ng minh to√†n b·ªô villa       ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ R√®m c·ª≠a t·ª± ƒë·ªông cho t·∫•t c·∫£ ph√≤ng                     ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ ƒêi·ªÅu h√≤a nhi·ªát ƒë·ªô AI                                 ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Camera gi√°m s√°t & chu√¥ng c·ª≠a th√¥ng minh              ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ T√≠ch h·ª£p ƒëi·ªÅu khi·ªÉn gi·ªçng n√≥i (Google Home)          ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ [üèóÔ∏è T·∫°o project] [üí∞ T·∫°o b√°o gi√°]                       ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  üí¨ L·ªäCH S·ª¨ T∆Ø∆†NG T√ÅC (5)              [+ Th√™m t∆∞∆°ng t√°c]        ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ üìû 01/11/2025 14:30 - G·ªçi ƒëi·ªán t∆∞ v·∫•n        by H·∫£i     ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ    N·ªôi dung: ƒê√£ gi·ªõi thi·ªáu s·∫£n ph·∫©m, kh√°ch quan t√¢m    ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ    ƒë·∫øn t√≠nh nƒÉng ƒëi·ªÅu khi·ªÉn t·ª´ xa v√† t√≠ch h·ª£p AI.      ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ    Y√™u c·∫ßu xem demo v√† b√°o gi√° chi ti·∫øt.               ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ    K·∫øt qu·∫£: ‚úÖ Interested                               ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ    Next: G·ª≠i b√°o gi√° QT-2025-001 v√†o 02/11             ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ    Duration: 30 ph√∫t                                    ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ    ‚Üí Task: [G·ª≠i b√°o gi√° 02/11] (Completed ‚úì)           ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ    [‚úèÔ∏è S·ª≠a] [üóëÔ∏è X√≥a]                                     ‚îÇ    ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§    ‚îÇ
‚îÇ  ‚îÇ ‚úâÔ∏è 28/10/2025 09:15 - Email gi·ªõi thi·ªáu      by H·∫£i     ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ    ƒê√£ g·ª≠i email gi·ªõi thi·ªáu c√¥ng ty v√† s·∫£n ph·∫©m Smart   ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ    Home. Kh√°ch ph·∫£n h·ªìi trong 2 gi·ªù, quan t√¢m.         ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ    K·∫øt qu·∫£: ‚úÖ Interested                               ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ    Next: G·ªçi ƒëi·ªán t∆∞ v·∫•n chi ti·∫øt                      ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ    [‚úèÔ∏è S·ª≠a] [üóëÔ∏è X√≥a]                                     ‚îÇ    ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§    ‚îÇ
‚îÇ  ‚îÇ üåê 25/10/2025 15:20 - ƒêi·ªÅn form website     (Inbound)  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ    Lead t·ª´ website, ƒëi·ªÅn form y√™u c·∫ßu t∆∞ v·∫•n.         ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ    N·ªôi dung: C·∫ßn t∆∞ v·∫•n h·ªá th·ªëng nh√† th√¥ng minh cho    ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ    villa 500m¬≤                                          ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ    ‚Üí Auto t·∫°o customer & trigger scenario "Lead m·ªõi"    ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ    [‚úèÔ∏è S·ª≠a] [üóëÔ∏è X√≥a]                                     ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  [T·∫•t c·∫£ t∆∞∆°ng t√°c] [üì• Export]                                  ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ  ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  üí∞ B√ÅO GI√Å (1)                                                   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ üìÑ QT-2025-001 - B√°o gi√° h·ªá th·ªëng Smart Home            ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ    üí∞ 2.09 t·ª∑ (bao g·ªìm VAT) | üìÖ 02/11/2025             ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ    Status: ‚úâÔ∏è Sent ‚Üí üëÅÔ∏è Viewed (02/11 14:30)            ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ    Valid until: 31/12/2025                              ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ    [üëÅÔ∏è Xem] [‚úèÔ∏è S·ª≠a] [üì§ G·ª≠i l·∫°i] [‚úÖ Mark Won]          ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ  ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  ü§ñ K·ªäCH B·∫¢N ƒêANG CH·∫†Y                                           ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ ‚úÖ Lead m·ªõi t·ª´ Website                                   ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ    Step 1/3: ‚úÖ G·ª≠i email ch√†o m·ª´ng (Done)              ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ    Step 2/3: ‚úÖ G·ªçi ƒëi·ªán t∆∞ v·∫•n (Done)                  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ    Step 3/3: ‚è≥ Follow up sau 3 ng√†y (Scheduled 05/11)  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ    [‚è∏Ô∏è T·∫°m d·ª´ng] [‚ùå H·ªßy scenario]                       ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ  ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  üìù GHI CH√ö                                   [‚úèÔ∏è Ch·ªânh s·ª≠a]      ‚îÇ
‚îÇ  Kh√°ch h√†ng ti·ªÅm nƒÉng cao, ƒë√£ l√†m vi·ªác v·ªõi nhi·ªÅu nh√† th·∫ßu,      ‚îÇ
‚îÇ  quy·∫øt ƒë·ªãnh nhanh. Quan t√¢m ƒë·∫øn ch·∫•t l∆∞·ª£ng s·∫£n ph·∫©m v√† d·ªãch v·ª•   ‚îÇ
‚îÇ  h·∫≠u m√£i. Budget kh√¥ng ph·∫£i v·∫•n ƒë·ªÅ.                              ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  [üíæ L∆∞u ghi ch√∫]                                                ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ  ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  üìä TH·ªêNG K√ä                                                      ‚îÇ
‚îÇ  ‚Ä¢ T·∫°o l√∫c: 25/10/2025 15:20 (by System)                        ‚îÇ
‚îÇ  ‚Ä¢ C·∫≠p nh·∫≠t: 01/11/2025 14:30 (by H·∫£i)                          ‚îÇ
‚îÇ  ‚Ä¢ T·ªïng t∆∞∆°ng t√°c: 5 l·∫ßn                                         ‚îÇ
‚îÇ  ‚Ä¢ Doanh thu: 0ƒë (ch∆∞a c√≥ order)                                 ‚îÇ
‚îÇ  ‚Ä¢ Conversion probability: 85% (d·ª±a tr√™n AI prediction)          ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  [üìû G·ªçi ngay] [‚úâÔ∏è Email] [üí¨ Zalo] [üí∞ T·∫°o b√°o gi√°] [üèóÔ∏è T·∫°o d·ª± √°n]‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 2.3. Backend Logic - Customer Manager

**File:** `backend/crm/customer_manager.py`

```python
# -*- coding: utf-8 -*-
"""
CUSTOMER MANAGER
================

Qu·∫£n l√Ω kh√°ch h√†ng (CRUD operations + search + filters)

Functions:
- create_customer(customer_data) -> customer_id
- get_customer(customer_id) -> dict
- update_customer(customer_id, updates) -> bool
- delete_customer(customer_id) -> bool
- search_customers(query, filters) -> list
- get_customers_by_user(user_id, filters) -> list
- get_customers_need_follow_up(user_id, date) -> list
- assign_customer(customer_id, assigned_to) -> bool
- update_lead_status(customer_id, new_status) -> bool
- update_priority(customer_id, new_priority) -> bool
- add_tag(customer_id, tag) -> bool
- remove_tag(customer_id, tag) -> bool
"""

import uuid
import json
from datetime import datetime, timedelta
from typing import Dict, Any, List, Optional

class CustomerManager:
    def __init__(self, db):
        """
        Args:
            db: DatabaseManager instance
        """
        self.db = db

    def create_customer(self, customer_data: Dict[str, Any]) -> str:
        """
        T·∫°o kh√°ch h√†ng m·ªõi

        Args:
            customer_data: {
                'user_id': str,  # Sales owner
                'full_name': str,
                'phone_number': str,
                'email': str,
                'company_name': str,
                'tax_code': str,
                'address': str,
                'city': str,
                'district': str,
                'ward': str,
                'google_maps_url': str,
                'latitude': float,
                'longitude': float,
                'customer_type': str,  # individual/business/dealer
                'lead_source': str,    # facebook/zalo/website...
                'lead_status': str,    # new/contacted/qualified...
                'priority_level': str, # hot/warm/cold
                'industry': str,
                'project_scale': str,
                'estimated_budget': float,
                'expected_close_date': str,
                'assigned_to': str,  # user_id ph·ª• tr√°ch
                'facebook_url': str,
                'zalo_id': str,
                'telegram_id': str,
                'website': str,
                'tags': list,  # ['vip', 'fast_decision']
                'notes': str,
                'created_by': str
            }

        Returns:
            customer_id

        Algorithm:
            1. Validate required fields
            2. Generate customer_id
            3. Process tags (convert to JSON)
            4. Insert into database
            5. Trigger scenario n·∫øu lead_source match
            6. Return customer_id
        """
        try:
            # Validate
            if not customer_data.get('full_name'):
                raise ValueError("full_name is required")

            # Generate ID
            customer_id = f"cust_{uuid.uuid4().hex[:12]}"
            now = datetime.now().isoformat()

            # Process tags
            tags = customer_data.get('tags', [])
            tags_json = json.dumps(tags) if tags else None

            # Prepare record
            record = {
                'customer_id': customer_id,
                'user_id': customer_data.get('user_id'),
                'full_name': customer_data['full_name'],
                'phone_number': customer_data.get('phone_number'),
                'email': customer_data.get('email'),
                'company_name': customer_data.get('company_name'),
                'tax_code': customer_data.get('tax_code'),
                'address': customer_data.get('address'),
                'city': customer_data.get('city'),
                'district': customer_data.get('district'),
                'ward': customer_data.get('ward'),
                'google_maps_url': customer_data.get('google_maps_url'),
                'latitude': customer_data.get('latitude'),
                'longitude': customer_data.get('longitude'),
                'customer_type': customer_data.get('customer_type', 'individual'),
                'lead_source': customer_data.get('lead_source'),
                'lead_status': customer_data.get('lead_status', 'new'),
                'priority_level': customer_data.get('priority_level', 'cold'),
                'industry': customer_data.get('industry'),
                'project_scale': customer_data.get('project_scale'),
                'estimated_budget': customer_data.get('estimated_budget'),
                'expected_close_date': customer_data.get('expected_close_date'),
                'assigned_to': customer_data.get('assigned_to') or customer_data.get('user_id'),
                'last_contact_date': None,
                'next_follow_up_date': customer_data.get('next_follow_up_date'),
                'total_interactions': 0,
                'total_revenue': 0,
                'total_orders': 0,
                'facebook_url': customer_data.get('facebook_url'),
                'zalo_id': customer_data.get('zalo_id'),
                'telegram_id': customer_data.get('telegram_id'),
                'website': customer_data.get('website'),
                'tags': tags_json,
                'notes': customer_data.get('notes'),
                'created_at': now,
                'updated_at': now,
                'created_by': customer_data.get('created_by')
            }

            # Insert
            with self.db.get_connection() as conn:
                columns = ', '.join(record.keys())
                placeholders = ', '.join(['?' for _ in record])
                query = f"INSERT INTO customers ({columns}) VALUES ({placeholders})"

                self.db.execute_insert(conn, query, tuple(record.values()))
                conn.commit()

            print(f"‚úÖ Customer created: {customer_id}")

            # Trigger scenario
            self._trigger_scenario_if_match(customer_id, customer_data.get('lead_source'))

            return customer_id

        except Exception as e:
            print(f"‚ùå Error creating customer: {e}")
            raise

    def _trigger_scenario_if_match(self, customer_id: str, lead_source: str):
        """
        T·ª± ƒë·ªông trigger scenario n·∫øu lead_source match

        Example:
            Lead t·ª´ Facebook ‚Üí Trigger scenario "Lead m·ªõi t·ª´ Facebook"
        """
        try:
            if not lead_source:
                return

            from crm.scenario_manager import ScenarioManager
            scenario_manager = ScenarioManager(self.db)

            # T√¨m scenario match v·ªõi lead_source
            with self.db.get_connection() as conn:
                query = """
                    SELECT scenario_id
                    FROM customer_care_scenarios
                    WHERE is_active = 1
                    AND trigger_event = 'customer_created'
                    AND customer_segment = 'new_lead'
                """
                scenarios = self.db.execute_query(conn, query)

                for scenario in scenarios:
                    scenario_manager.start_scenario(customer_id, scenario['scenario_id'])
                    print(f"‚úÖ Started scenario {scenario['scenario_id']} for customer {customer_id}")

        except Exception as e:
            print(f"‚ö†Ô∏è  Error triggering scenario: {e}")

    def get_customer(self, customer_id: str) -> Optional[Dict[str, Any]]:
        """
        L·∫•y th√¥ng tin kh√°ch h√†ng

        Returns:
            dict with customer info + parsed tags
        """
        try:
            with self.db.get_connection() as conn:
                query = """
                    SELECT c.*,
                           u1.display_name as assigned_to_name,
                           u2.display_name as created_by_name
                    FROM customers c
                    LEFT JOIN users u1 ON c.assigned_to = u1.user_id
                    LEFT JOIN users u2 ON c.created_by = u2.user_id
                    WHERE c.customer_id = ?
                """
                results = self.db.execute_query(conn, query, (customer_id,))

                if results:
                    customer = results[0]

                    # Parse tags
                    if customer['tags']:
                        customer['tags'] = json.loads(customer['tags'])
                    else:
                        customer['tags'] = []

                    return customer

                return None

        except Exception as e:
            print(f"‚ùå Error getting customer: {e}")
            return None

    def update_customer(self, customer_id: str, updates: Dict[str, Any]) -> bool:
        """
        C·∫≠p nh·∫≠t th√¥ng tin kh√°ch h√†ng

        Args:
            customer_id: ID customer
            updates: Dict c√°c field c·∫ßn update

        Returns:
            True n·∫øu th√†nh c√¥ng
        """
        try:
            allowed_fields = [
                'full_name', 'phone_number', 'email', 'company_name', 'tax_code',
                'address', 'city', 'district', 'ward',
                'google_maps_url', 'latitude', 'longitude',
                'customer_type', 'lead_source', 'lead_status', 'priority_level',
                'industry', 'project_scale', 'estimated_budget', 'expected_close_date',
                'assigned_to', 'next_follow_up_date',
                'facebook_url', 'zalo_id', 'telegram_id', 'website',
                'tags', 'notes'
            ]

            set_strs = []
            params = []

            for field in allowed_fields:
                if field in updates:
                    value = updates[field]

                    # Process tags
                    if field == 'tags' and isinstance(value, list):
                        value = json.dumps(value)

                    set_strs.append(f"{field} = ?")
                    params.append(value)

            if not set_strs:
                return False

            set_strs.append("updated_at = ?")
            params.append(datetime.now().isoformat())
            params.append(customer_id)

            with self.db.get_connection() as conn:
                query = f"UPDATE customers SET {', '.join(set_strs)} WHERE customer_id = ?"
                self.db.execute_update(conn, query, tuple(params))
                conn.commit()

            print(f"‚úÖ Customer updated: {customer_id}")
            return True

        except Exception as e:
            print(f"‚ùå Error updating customer: {e}")
            return False

    def delete_customer(self, customer_id: str) -> bool:
        """X√≥a kh√°ch h√†ng (CASCADE s·∫Ω x√≥a interactions, quotations...)"""
        try:
            with self.db.get_connection() as conn:
                query = "DELETE FROM customers WHERE customer_id = ?"
                self.db.execute_update(conn, query, (customer_id,))
                conn.commit()

            print(f"‚úÖ Customer deleted: {customer_id}")
            return True

        except Exception as e:
            print(f"‚ùå Error deleting customer: {e}")
            return False

    def search_customers(
        self,
        query: str = None,
        filters: Dict[str, Any] = None,
        limit: int = 100,
        offset: int = 0
    ) -> List[Dict[str, Any]]:
        """
        T√¨m ki·∫øm & l·ªçc kh√°ch h√†ng

        Args:
            query: T√¨m theo t√™n, SƒêT, email, c√¥ng ty
            filters: {
                'user_id': str,         # Customers c·ªßa user n√†y
                'assigned_to': str,     # ƒê∆∞·ª£c assign cho user n√†y
                'lead_status': str,     # new/contacted/qualified...
                'priority_level': str,  # hot/warm/cold
                'lead_source': str,     # facebook/zalo...
                'customer_type': str,   # individual/business
                'tags': list,           # ['vip', 'fast_decision']
                'created_from': str,    # T·∫°o t·ª´ ng√†y
                'created_to': str       # T·∫°o ƒë·∫øn ng√†y
            }
            limit: S·ªë l∆∞·ª£ng t·ªëi ƒëa
            offset: Skip bao nhi√™u records

        Returns:
            List of customers
        """
        try:
            with self.db.get_connection() as conn:
                conditions = []
                params = []

                # Search query
                if query:
                    conditions.append("""
                        (full_name LIKE ? OR
                         phone_number LIKE ? OR
                         email LIKE ? OR
                         company_name LIKE ?)
                    """)
                    search_param = f"%{query}%"
                    params.extend([search_param, search_param, search_param, search_param])

                # Filters
                if filters:
                    if filters.get('user_id'):
                        conditions.append("user_id = ?")
                        params.append(filters['user_id'])

                    if filters.get('assigned_to'):
                        conditions.append("assigned_to = ?")
                        params.append(filters['assigned_to'])

                    if filters.get('lead_status'):
                        conditions.append("lead_status = ?")
                        params.append(filters['lead_status'])

                    if filters.get('priority_level'):
                        conditions.append("priority_level = ?")
                        params.append(filters['priority_level'])

                    if filters.get('lead_source'):
                        conditions.append("lead_source = ?")
                        params.append(filters['lead_source'])

                    if filters.get('customer_type'):
                        conditions.append("customer_type = ?")
                        params.append(filters['customer_type'])

                    if filters.get('tags'):
                        # Search trong JSON tags
                        for tag in filters['tags']:
                            conditions.append("tags LIKE ?")
                            params.append(f'%"{tag}"%')

                    if filters.get('created_from'):
                        conditions.append("created_at >= ?")
                        params.append(filters['created_from'])

                    if filters.get('created_to'):
                        conditions.append("created_at <= ?")
                        params.append(filters['created_to'])

                # Build query
                where_clause = " WHERE " + " AND ".join(conditions) if conditions else ""

                query_sql = f"""
                    SELECT c.*,
                           u.display_name as assigned_to_name
                    FROM customers c
                    LEFT JOIN users u ON c.assigned_to = u.user_id
                    {where_clause}
                    ORDER BY c.updated_at DESC
                    LIMIT ? OFFSET ?
                """

                params.extend([limit, offset])

                results = self.db.execute_query(conn, query_sql, tuple(params))

                # Parse tags for each customer
                for customer in results:
                    if customer['tags']:
                        customer['tags'] = json.loads(customer['tags'])
                    else:
                        customer['tags'] = []

                return results

        except Exception as e:
            print(f"‚ùå Error searching customers: {e}")
            return []

    def get_customers_need_follow_up(
        self,
        user_id: str = None,
        date: str = None
    ) -> List[Dict[str, Any]]:
        """
        L·∫•y danh s√°ch customers c·∫ßn follow up

        Args:
            user_id: N·∫øu cung c·∫•p, ch·ªâ l·∫•y customers c·ªßa user n√†y
            date: Ng√†y c·∫ßn follow (default = h√¥m nay)

        Returns:
            List of customers c·∫ßn follow up

        Algorithm:
            1. N·∫øu date = None ‚Üí date = today
            2. Query customers c√≥ next_follow_up_date = date
            3. Order by priority_level (hot > warm > cold)
            4. Return results
        """
        try:
            if date is None:
                date = datetime.now().strftime('%Y-%m-%d')

            with self.db.get_connection() as conn:
                conditions = [
                    "DATE(next_follow_up_date) = ?",
                    "lead_status NOT IN ('won', 'lost', 'archived')"
                ]
                params = [date]

                if user_id:
                    conditions.append("(user_id = ? OR assigned_to = ?)")
                    params.extend([user_id, user_id])

                where_clause = " WHERE " + " AND ".join(conditions)

                query = f"""
                    SELECT c.*,
                           u.display_name as assigned_to_name
                    FROM customers c
                    LEFT JOIN users u ON c.assigned_to = u.user_id
                    {where_clause}
                    ORDER BY
                        CASE priority_level
                            WHEN 'hot' THEN 1
                            WHEN 'warm' THEN 2
                            WHEN 'cold' THEN 3
                            ELSE 4
                        END,
                        next_follow_up_date ASC
                """

                results = self.db.execute_query(conn, query, tuple(params))

                # Parse tags
                for customer in results:
                    if customer['tags']:
                        customer['tags'] = json.loads(customer['tags'])
                    else:
                        customer['tags'] = []

                return results

        except Exception as e:
            print(f"‚ùå Error getting follow-up customers: {e}")
            return []

    def assign_customer(self, customer_id: str, assigned_to: str) -> bool:
        """Assign customer cho user kh√°c"""
        try:
            with self.db.get_connection() as conn:
                query = "UPDATE customers SET assigned_to = ?, updated_at = ? WHERE customer_id = ?"
                self.db.execute_update(conn, query, (assigned_to, datetime.now().isoformat(), customer_id))
                conn.commit()

            print(f"‚úÖ Customer {customer_id} assigned to {assigned_to}")
            return True

        except Exception as e:
            print(f"‚ùå Error assigning customer: {e}")
            return False

    def update_lead_status(self, customer_id: str, new_status: str) -> bool:
        """
        C·∫≠p nh·∫≠t lead status

        Statuses: new ‚Üí contacted ‚Üí qualified ‚Üí proposal ‚Üí negotiation ‚Üí won/lost
        """
        try:
            with self.db.get_connection() as conn:
                query = "UPDATE customers SET lead_status = ?, updated_at = ? WHERE customer_id = ?"
                self.db.execute_update(conn, query, (new_status, datetime.now().isoformat(), customer_id))
                conn.commit()

            print(f"‚úÖ Customer {customer_id} status updated to {new_status}")

            # N·∫øu won ‚Üí T·∫°o notification celebration
            if new_status == 'won':
                self._notify_won_deal(customer_id)

            return True

        except Exception as e:
            print(f"‚ùå Error updating lead status: {e}")
            return False

    def _notify_won_deal(self, customer_id: str):
        """G·ª≠i notification khi won deal"""
        try:
            customer = self.get_customer(customer_id)
            if not customer:
                return

            message = f"üéâ Ch√∫c m·ª´ng! B·∫°n ƒë√£ ch·ªët deal v·ªõi kh√°ch h√†ng: {customer['full_name']}"

            from notifications.telegram_notifier import TelegramNotifier
            from utils.config_loader import ConfigLoader

            config = ConfigLoader.load_config()
            notifier = TelegramNotifier(config)

            # G·ª≠i cho assigned user
            with self.db.get_connection() as conn:
                query = "SELECT telegram_user_id FROM users WHERE user_id = ?"
                user = self.db.execute_query(conn, query, (customer['assigned_to'],))

                if user and user[0].get('telegram_user_id'):
                    notifier.send_notification(user[0]['telegram_user_id'], message)

        except Exception as e:
            print(f"‚ö†Ô∏è  Error notifying won deal: {e}")

    def update_priority(self, customer_id: str, new_priority: str) -> bool:
        """C·∫≠p nh·∫≠t priority level (hot/warm/cold)"""
        try:
            with self.db.get_connection() as conn:
                query = "UPDATE customers SET priority_level = ?, updated_at = ? WHERE customer_id = ?"
                self.db.execute_update(conn, query, (new_priority, datetime.now().isoformat(), customer_id))
                conn.commit()

            print(f"‚úÖ Customer {customer_id} priority updated to {new_priority}")
            return True

        except Exception as e:
            print(f"‚ùå Error updating priority: {e}")
            return False

    def add_tag(self, customer_id: str, tag: str) -> bool:
        """Th√™m tag cho customer"""
        try:
            customer = self.get_customer(customer_id)
            if not customer:
                return False

            tags = customer['tags']
            if tag not in tags:
                tags.append(tag)
                return self.update_customer(customer_id, {'tags': tags})

            return True

        except Exception as e:
            print(f"‚ùå Error adding tag: {e}")
            return False

    def remove_tag(self, customer_id: str, tag: str) -> bool:
        """X√≥a tag kh·ªèi customer"""
        try:
            customer = self.get_customer(customer_id)
            if not customer:
                return False

            tags = customer['tags']
            if tag in tags:
                tags.remove(tag)
                return self.update_customer(customer_id, {'tags': tags})

            return True

        except Exception as e:
            print(f"‚ùå Error removing tag: {e}")
            return False


# Test function
def test_customer_manager():
    """Test CustomerManager"""
    from core.database_manager import DatabaseManager

    db = DatabaseManager("test_customers.db")
    manager = CustomerManager(db)

    # Test create
    customer_data = {
        'user_id': 'user_123',
        'full_name': 'Nguy·ªÖn VƒÉn A',
        'phone_number': '0909123456',
        'email': 'test@example.com',
        'company_name': 'Test Company',
        'customer_type': 'business',
        'lead_source': 'website',
        'lead_status': 'new',
        'priority_level': 'hot',
        'assigned_to': 'user_123',
        'tags': ['vip', 'test'],
        'notes': 'Test customer',
        'created_by': 'admin'
    }

    customer_id = manager.create_customer(customer_data)
    print(f"‚úÖ Created customer: {customer_id}")

    # Test get
    customer = manager.get_customer(customer_id)
    print(f"‚úÖ Got customer: {customer['full_name']}")
    print(f"   Tags: {customer['tags']}")

    # Test update
    manager.update_customer(customer_id, {'priority_level': 'warm'})
    print(f"‚úÖ Updated priority")

    # Test search
    results = manager.search_customers(query='Nguy·ªÖn')
    print(f"‚úÖ Search results: {len(results)}")

    # Test tags
    manager.add_tag(customer_id, 'fast_decision')
    manager.remove_tag(customer_id, 'test')
    customer = manager.get_customer(customer_id)
    print(f"‚úÖ Updated tags: {customer['tags']}")

    # Cleanup
    import os
    os.remove("test_customers.db")
    print("‚úÖ Test passed!")

if __name__ == "__main__":
    test_customer_manager()
```

---

(File n√†y qu√° d√†i, t√¥i s·∫Ω t·∫°o ph·∫ßn 2 cho ph·∫ßn c√≤n l·∫°i...)
